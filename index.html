<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#06b6d4">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="icon" type="image/svg+xml" href="assets/icons/icon.svg">
  <link rel="icon" type="image/png" sizes="192x192" href="assets/icons/icon-192.png">
  <link rel="apple-touch-icon" sizes="192x192" href="assets/icons/icon-192.png">
  <title>BUILD Workout Tracker</title>
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/components.css">
  <link rel="stylesheet" href="css/screens.css">
  <link rel="stylesheet" href="css/workout-screen.css">
  <link rel="stylesheet" href="css/progressive-disclosure.css">
  <link rel="stylesheet" href="css/warm-up.css">
  <link rel="stylesheet" href="css/recovery-modal.css">
  <link rel="stylesheet" href="css/sticky-input.css">
  <link rel="stylesheet" href="css/post-set-feedback.css">
  <link rel="stylesheet" href="css/number-overlay.css">
  <link rel="stylesheet" href="css/edit-entry-modal.css">
  <link rel="stylesheet" href="css/deload-modal.css">
  <link rel="stylesheet" href="css/history-screen.css">
  <link rel="stylesheet" href="css/progress-chart.css">
  <link rel="stylesheet" href="css/exercise-detail.css">
  <link rel="stylesheet" href="css/export-import.css">
  <link rel="stylesheet" href="css/progress-dashboard.css">
  <link rel="stylesheet" href="css/summary-screen.css">
  <link rel="stylesheet" href="css/analytics.css">
  <link rel="stylesheet" href="css/achievements.css">
  <link rel="stylesheet" href="css/workout-reference.css">
  <link rel="stylesheet" href="css/unlock-notifications.css">
  <link rel="stylesheet" href="css/exercise-progressions.css">
  <link rel="stylesheet" href="css/warm-up-protocols.css">
  <link rel="stylesheet" href="css/optional-fifth-day.css">
</head>
<body>
  <div id="app">
    <!-- Home Screen -->
    <div id="home-screen" class="screen active">
      <header class="app-header">
        <h1>BUILD Tracker</h1>
        <button id="settings-btn" class="icon-btn" aria-label="Settings">‚öôÔ∏è</button>
      </header>

      <main class="screen-content">
        <section class="workout-card">
          <h2>Next Workout</h2>
          <p id="next-workout-name" class="workout-name">Upper A - Horizontal</p>
          <p id="last-trained" class="meta">Last trained: Never</p>

          <button id="start-workout-btn" class="btn-primary btn-large">
            START WORKOUT
          </button>
        </section>

        <section class="quick-actions">
          <h3>Quick Actions</h3>
          <div class="action-grid">
            <button class="action-btn">üìä History</button>
            <button id="progress-btn" class="action-btn">üìà Progress</button>
          </div>
        </section>

        <div class="optional-training-card">
          <h3>Optional Training</h3>
          <button id="optional-fifth-day-btn" class="btn-secondary">
            üí™ Injury Prevention + Core Day
          </button>
        </div>

        <div id="cycle-progress" class="cycle-progress">
          <!-- populated by JavaScript -->
        </div>

        <section id="recovery-status" class="recovery-card">
          <h3>Recovery Status</h3>
          <div id="recovery-list">
            <p class="recovery-ok">‚úì All muscles recovered</p>
          </div>
        </section>
      </main>
    </div>

    <!-- In-Workout Screen (hidden by default) -->
    <div id="workout-screen" class="screen">
      <header class="app-header">
        <button id="back-btn" class="icon-btn">‚Üê</button>
        <h1 id="workout-title">Upper A</h1>
        <span id="timer">00:00</span>
        <button id="workout-settings-btn" class="icon-btn">‚öôÔ∏è</button>
      </header>

      <main class="screen-content">
        <div id="exercise-list">
          <!-- Dynamically populated -->
        </div>

        <button id="complete-workout-btn" class="btn-primary btn-large" style="display: none;">
          COMPLETE WORKOUT
        </button>
      </main>
    </div>

    <!-- Post-Workout Summary Screen -->
    <div id="summary-screen" class="screen">
      <header class="app-header">
        <button id="summary-back-btn" class="icon-btn" aria-label="Back">‚Üê</button>
        <h1>Workout Summary</h1>
        <span></span>
      </header>

      <main class="screen-content">
        <h2 class="summary-title">‚úÖ Workout Complete!</h2>

        <!-- Stats Section -->
        <div id="summary-stats" class="summary-section">
          <!-- Populated dynamically -->
        </div>

        <!-- Pain Tracking Section -->
        <div id="summary-pain" class="summary-section">
          <h2 class="section-title">üí™ Pain Check</h2>

          <!-- Initial selection -->
          <div id="pain-initial-choice" class="pain-choice-buttons">
            <button id="pain-no-summary" class="btn btn-primary" aria-label="No pain">No pain ‚úì</button>
            <button id="pain-yes-summary" class="btn btn-secondary" aria-label="Yes, I had pain">Yes, I had pain</button>
          </div>

          <!-- Exercise selection (hidden initially) -->
          <div id="pain-exercise-selection-summary" style="display: none;">
            <p>Which exercises had pain? (Select all that apply)</p>
            <div id="pain-exercise-list-summary" class="pain-exercise-checkboxes">
              <!-- Populated dynamically -->
            </div>
            <button id="pain-next-summary" class="btn btn-primary">Next ‚Üí</button>
          </div>

          <!-- Pain details (hidden initially) -->
          <div id="pain-details-summary" style="display: none;">
            <h3 id="pain-current-exercise">Exercise Name</h3>
            <p id="pain-exercise-progress">Progress info</p>

            <p>How severe was the pain?</p>
            <div class="pain-severity-buttons-summary">
              <button class="pain-severity-btn btn btn-secondary" data-severity="minor" aria-label="Minor pain">Minor</button>
              <button class="pain-severity-btn btn btn-secondary" data-severity="significant" aria-label="Significant pain">Significant</button>
            </div>

            <p>Where was the pain?</p>
            <div class="pain-location-buttons-summary">
              <button class="pain-location-btn btn btn-secondary" data-location="shoulder" aria-label="Shoulder pain">Shoulder</button>
              <button class="pain-location-btn btn btn-secondary" data-location="elbow" aria-label="Elbow pain">Elbow</button>
              <button class="pain-location-btn btn btn-secondary" data-location="wrist" aria-label="Wrist pain">Wrist</button>
              <button class="pain-location-btn btn btn-secondary" data-location="lower_back" aria-label="Lower back pain">Lower back</button>
              <button class="pain-location-btn btn btn-secondary" data-location="knee" aria-label="Knee pain">Knee</button>
              <button class="pain-location-btn btn btn-secondary" data-location="hip" aria-label="Hip pain">Hip</button>
              <button class="pain-location-btn btn btn-secondary" data-location="other" aria-label="Other location pain">Other</button>
            </div>
          </div>
        </div>

        <!-- Weigh-in Section (conditional) -->
        <div id="summary-weighin" class="summary-section" style="display: none;">
          <h2 class="section-title">‚öñÔ∏è Log Today's Weight</h2>
          <div class="weighin-input-group">
            <label for="weighin-input-summary" class="visually-hidden">Body weight</label>
            <input type="number" id="weighin-input-summary" placeholder="75.5" step="0.1" min="30" max="200" inputmode="decimal" autocomplete="off">
            <span class="unit-label">kg</span>
          </div>
        </div>

        <!-- Done Button -->
        <button id="summary-done-btn" class="btn btn-primary btn-large">Done ‚úì</button>
      </main>
    </div>

    <!-- History Screen -->
    <div id="history-screen" class="screen">
      <header class="app-header">
        <button id="history-back-btn" class="icon-btn">‚Üê</button>
        <h1>Workout History</h1>
        <span></span>
      </header>

      <main class="screen-content">
        <div id="history-list">
          <!-- Populated by HistoryListScreen -->
        </div>
      </main>
    </div>

    <!-- Exercise Detail Screen -->
    <div id="exercise-detail-screen" class="screen">
      <header class="app-header">
        <button id="exercise-detail-back-btn" class="icon-btn">‚Üê</button>
        <h1 id="exercise-detail-title">Exercise</h1>
        <span></span>
      </header>

      <main class="screen-content">
        <div class="chart-container">
          <h3 class="chart-title">Weight Progression</h3>
          <canvas id="progress-chart"></canvas>
        </div>

        <div id="workout-history-list">
          <!-- Populated by ExerciseDetailScreen -->
        </div>

        <button id="export-exercise-btn" class="btn btn-secondary">
          üì§ Export Data
        </button>
      </main>
    </div>

    <!-- Progress Dashboard Screen -->
    <div id="progress-screen" class="screen">
      <header class="app-header">
        <button id="progress-back-btn" class="icon-btn">‚Üê</button>
        <h1>Progress Dashboard</h1>
        <button id="progress-settings-btn" class="icon-btn" aria-label="Settings">‚öôÔ∏è</button>
      </header>

      <main class="screen-content">
        <div class="progress-tabs">
          <button class="tab-btn active" data-tab="overview">Overview</button>
          <button class="tab-btn" data-tab="body-weight">Body Weight</button>
          <button class="tab-btn" data-tab="barbell">Barbell</button>
          <button class="tab-btn" data-tab="analytics">Analytics</button>
        </div>

        <div class="tab-content overview-tab" id="overview-tab">
          <div id="progress-content">
            <!-- Populated by showProgressDashboard() -->
          </div>
        </div>

        <div class="tab-content body-weight-tab" id="body-weight-tab" style="display: none;">
          <!-- Body weight content will be rendered here -->
        </div>

        <div class="tab-content barbell-tab" id="barbell-tab" style="display: none;">
          <!-- Barbell progression content will be rendered here -->
        </div>

        <div class="tab-content analytics-tab" id="analytics-tab" style="display: none;">
          <div id="analytics-content">
            <!-- Analytics will be rendered here -->
          </div>
        </div>
      </main>
    </div>

    <!-- Fifth Day Screen -->
    <div id="fifth-day-screen" class="screen">
      <header class="app-header">
        <button id="fifth-day-back-btn" class="icon-btn">‚Üê</button>
        <h1>Optional Training</h1>
        <span></span>
      </header>

      <main class="screen-content">
        <div id="fifth-day-content"></div>
      </main>
    </div>
  </div>

  <!-- Recovery Warning Modal -->
  <div id="recovery-modal" class="modal" style="display: none;">
    <div class="modal-content recovery-warning">
      <h2>‚ö†Ô∏è Recovery Check</h2>
      <div id="recovery-modal-body">
        <!-- populated by JavaScript -->
      </div>
      <div class="modal-actions">
        <button id="wait-recovery-btn" class="btn btn-primary">Wait Until Tomorrow</button>
        <button id="train-anyway-btn" class="btn btn-secondary">Train Anyway - I Feel Great</button>
      </div>
    </div>
  </div>

  <!-- Number Input Overlay -->
  <div id="number-overlay" class="number-overlay" style="display: none;">
    <div class="overlay-content">
      <div class="overlay-header">
        <h3 id="overlay-title">Edit Weight</h3>
        <button id="overlay-close" class="overlay-close">‚úï</button>
      </div>

      <div class="overlay-display">
        <span id="overlay-value">0</span>
        <span id="overlay-unit">kg</span>
      </div>

      <div class="number-pad">
        <button class="num-btn" data-value="7">7</button>
        <button class="num-btn" data-value="8">8</button>
        <button class="num-btn" data-value="9">9</button>
        <button class="quick-btn" data-value="+2.5">+2.5</button>

        <button class="num-btn" data-value="4">4</button>
        <button class="num-btn" data-value="5">5</button>
        <button class="num-btn" data-value="6">6</button>
        <button class="quick-btn" data-value="+5.0">+5.0</button>

        <button class="num-btn" data-value="1">1</button>
        <button class="num-btn" data-value="2">2</button>
        <button class="num-btn" data-value="3">3</button>
        <button class="quick-btn" data-value="-2.5">-2.5</button>

        <button class="num-btn backspace" data-value="back">‚Üê</button>
        <button class="num-btn" data-value="0">0</button>
        <button class="num-btn" data-value=".">.</button>
        <button class="num-btn clear" data-value="clear">C</button>
      </div>

      <button id="overlay-confirm" class="overlay-confirm">CONFIRM</button>
    </div>
  </div>

  <!-- Edit Entry Modal -->
  <div id="edit-entry-modal">
    <div class="edit-modal-content">
      <div class="edit-modal-header">
        <h2>Edit Workout</h2>
      </div>

      <div class="edit-date-section">
        <label for="edit-entry-date">Date</label>
        <input type="date" id="edit-entry-date" />
      </div>

      <div id="edit-sets-container">
        <!-- Populated by EditEntryModal -->
      </div>

      <div class="edit-modal-actions">
        <button id="edit-entry-cancel">Cancel</button>
        <button id="edit-entry-save">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Recovery Metrics Modal -->
  <div id="recovery-metrics-modal" class="modal" style="display: none;">
    <div class="modal-content recovery-metrics-content">
      <h2>üí™ Recovery Check</h2>

      <div class="recovery-form">
        <div class="recovery-input-group">
          <label for="sleep-hours">üò¥ Sleep Last Night</label>
          <input
            type="number"
            id="sleep-hours"
            min="0"
            max="12"
            step="1"
            value="7"
            class="recovery-number-input"
          >
          <span class="input-hint">hours (0-12)</span>
        </div>

        <div class="recovery-input-group">
          <label>üò∞ Stress Level</label>
          <div class="radio-button-group stress-buttons">
            <button type="button" class="radio-btn selected" data-value="Low">Low</button>
            <button type="button" class="radio-btn" data-value="Medium">Medium</button>
            <button type="button" class="radio-btn" data-value="High">High</button>
          </div>
          <input type="hidden" id="stress-level" value="Low">
        </div>

        <div class="recovery-input-group">
          <label>‚ö° Energy Level</label>
          <div class="radio-button-group energy-buttons">
            <button type="button" class="radio-btn" data-value="1">1</button>
            <button type="button" class="radio-btn" data-value="2">2</button>
            <button type="button" class="radio-btn selected" data-value="3">3</button>
            <button type="button" class="radio-btn" data-value="4">4</button>
            <button type="button" class="radio-btn" data-value="5">5</button>
          </div>
          <span class="input-hint">1 = very low, 5 = very high</span>
          <input type="hidden" id="energy-level" value="3">
        </div>

        <div class="recovery-input-group">
          <label>üíä Muscle Soreness</label>
          <div class="radio-button-group soreness-buttons">
            <button type="button" class="radio-btn selected" data-value="None">None</button>
            <button type="button" class="radio-btn" data-value="Mild">Mild</button>
            <button type="button" class="radio-btn" data-value="Moderate">Moderate</button>
            <button type="button" class="radio-btn" data-value="Severe">Severe</button>
          </div>
          <input type="hidden" id="muscle-soreness" value="None">
        </div>
      </div>

      <div class="modal-actions">
        <button id="submit-recovery-btn" class="btn btn-primary">Continue to Workout</button>
      </div>
    </div>
  </div>

  <!-- Fatigue Warning Banner -->
  <div id="fatigue-warning-banner" class="fatigue-warning-banner" style="display: none;">
    <h2>‚ö†Ô∏è Fatigue Warning</h2>
    <p class="fatigue-score" id="fatigue-score-text">Your recovery score is 0/9.</p>
    <div class="warning-options">
      <p><strong>Consider:</strong></p>
      <ul>
        <li>Take a rest day (recommended)</li>
        <li>Do a lighter deload workout</li>
        <li>Continue if you feel okay</li>
      </ul>
    </div>
    <div class="warning-actions">
      <button id="dismiss-warning-btn" class="btn btn-secondary">Dismiss</button>
      <button id="deload-warning-btn" class="btn btn-secondary">Start Deload</button>
      <button id="continue-warning-btn" class="btn btn-primary">Continue Anyway</button>
    </div>
  </div>

  <!-- Deload Modal -->
  <div id="deload-modal" class="modal" style="display: none;">
    <div class="modal-content deload-modal">
      <h2>‚ö†Ô∏è Deload Week Recommended</h2>
      <div id="deload-modal-body">
        <!-- populated by JavaScript -->
      </div>
      <div class="modal-actions">
        <button id="start-deload-btn" class="btn btn-primary">Start Deload Now</button>
        <button id="postpone-deload-btn" class="btn btn-secondary">Remind Me Next Workout</button>
        <button id="dismiss-deload-btn" class="btn btn-tertiary">Dismiss</button>
      </div>
    </div>
  </div>

  <!-- Deload Banner (shown during deload week) -->
  <div id="deload-banner" class="deload-banner" style="display: none;">
    <div class="banner-content">
      <span class="banner-icon">üü°</span>
      <div class="banner-text">
        <strong>DELOAD WEEK</strong>
        <span id="banner-details"><!-- type and days remaining --></span>
      </div>
      <button id="end-deload-btn" class="banner-action">End Early</button>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settings-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>‚öôÔ∏è Settings</h2>
        <button id="settings-close-btn" class="icon-btn">‚úï</button>
      </div>

      <div class="modal-body">
        <!-- Exercise Progressions Section -->
        <section class="settings-section">
          <h3>Exercise Progressions</h3>
          <p class="settings-description">Browse and switch to unlocked exercise variations</p>
          <button id="browse-progressions-btn" class="action-btn">
            Browse Available Progressions
          </button>
        </section>

        <!-- Training Phase Toggle -->
        <section class="settings-section">
          <h3>Training Phase</h3>
          <p class="settings-description">Switch between Building and Maintenance modes</p>
          <div class="phase-toggle">
            <button id="phase-building-btn" class="phase-btn active">Building</button>
            <button id="phase-maintenance-btn" class="phase-btn">Maintenance</button>
          </div>
          <p class="phase-info" id="phase-info-text">
            Building: Focus on progressive overload and strength gains
          </p>
        </section>

        <!-- Equipment Profile -->
        <section class="settings-section">
          <h3>Equipment Profile</h3>
          <p class="settings-description">Select available equipment to filter progression options and warm-ups</p>
          <div class="equipment-toggles">
            <label class="equipment-toggle">
              <input type="checkbox" id="equipment-gym" checked>
              <span class="toggle-label">üèãÔ∏è Gym Equipment (cables, machines)</span>
            </label>
            <label class="equipment-toggle">
              <input type="checkbox" id="equipment-dumbbells" checked>
              <span class="toggle-label">üî© Dumbbells</span>
            </label>
            <label class="equipment-toggle">
              <input type="checkbox" id="equipment-barbells" checked>
              <span class="toggle-label">üí™ Barbells</span>
            </label>
            <label class="equipment-toggle">
              <input type="checkbox" id="equipment-mudgal" checked>
              <span class="toggle-label">ü™É Mudgal/Gada</span>
            </label>
            <label class="equipment-toggle">
              <input type="checkbox" id="equipment-bodyweight" checked disabled>
              <span class="toggle-label">üßò Bodyweight (always available)</span>
            </label>
            <label class="equipment-toggle">
              <input type="checkbox" id="equipment-bands" checked>
              <span class="toggle-label">üéØ Resistance Bands</span>
            </label>
          </div>
        </section>

        <section class="settings-section">
          <h3>Data Management</h3>

          <div class="export-import-container">
            <p class="section-description">
              Backup your workout data or restore from a previous backup.
            </p>

            <button id="export-data-btn" class="btn-secondary btn-large">
              üì§ Export All Data
            </button>

            <button id="import-data-btn" class="btn-secondary btn-large">
              üì• Import Data
            </button>

            <input type="file" id="import-file-input" accept=".json" style="display: none;" />
          </div>

          <div id="data-summary" class="data-summary" style="display: none;">
            <!-- Populated when showing import preview -->
          </div>
        </section>

        <section class="settings-section">
          <h3>Reset Options</h3>
          <p class="section-description warning-text">
            ‚ö†Ô∏è Use these options if you encounter bugs or need to start fresh.
          </p>

          <button id="reset-rotation-btn" class="btn-warning btn-large">
            üîÑ Reset Rotation Only
          </button>
          <p class="reset-description">Resets workout progression and streak while keeping all exercise history.</p>

          <button id="reset-history-btn" class="btn-danger btn-large">
            üóëÔ∏è Clear History Only
          </button>
          <p class="reset-description">Deletes all exercise history while keeping current rotation state.</p>

          <button id="reset-all-btn" class="btn-danger btn-large">
            ‚ö†Ô∏è Reset Everything
          </button>
          <p class="reset-description">Completely resets the app to initial state. This cannot be undone!</p>
        </section>

        <section class="settings-section">
          <h3>About</h3>
          <p class="about-text">
            BUILD Workout Tracker v1.0<br>
            Zero-dependency PWA for progressive overload tracking
          </p>
        </section>
      </div>
    </div>
  </div>

  <!-- Weigh-In Modal -->
  <div id="weighin-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <h2>üìä Weekly Weigh-In</h2>
      <p>Track your body composition progress</p>

      <div class="modal-body">
        <label for="weight-input">Body Weight (kg):</label>
        <input
          type="number"
          id="weight-input"
          min="30"
          max="200"
          step="0.1"
          placeholder="57.5"
        >
      </div>

      <div class="modal-actions">
        <button id="log-weight-btn" class="primary-btn">Log Weight</button>
        <button id="skip-weighin-btn" class="secondary-btn">Skip This Week</button>
      </div>
    </div>
  </div>

  <!-- Mobility Check Modal -->
  <div id="mobility-check-modal" class="modal" style="display: none;">
    <div class="modal-content mobility-check-modal">
      <h2>Mobility Check</h2>
      <p id="mobility-question" class="mobility-question"></p>
      <div class="mobility-help">
        <span class="help-icon">‚ÑπÔ∏è</span>
        <span id="mobility-help" class="mobility-help-text"></span>
      </div>
      <div class="mobility-buttons">
        <button id="mobility-yes" class="btn btn-success">Yes</button>
        <button id="mobility-no" class="btn btn-danger">No</button>
        <button id="mobility-not-sure" class="btn btn-secondary">Not sure</button>
      </div>
      <p id="mobility-progress" class="mobility-progress"></p>
      <p id="mobility-recent" class="mobility-recent"></p>
    </div>
  </div>

  <!-- Pain Tracking Modal -->
  <div id="pain-tracking-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <h3 id="pain-exercise-title">Exercise Complete</h3>
      <p class="pain-question">Any pain or discomfort during this exercise?</p>

      <div class="pain-severity-buttons">
        <button id="pain-no" class="btn btn-success">No</button>
        <button id="pain-minor" class="btn btn-warning">Yes, minor</button>
        <button id="pain-significant" class="btn btn-danger">Yes, significant</button>
      </div>

      <div id="pain-location-section" style="display: none;">
        <p class="pain-location-label">Where?</p>
        <div class="pain-location-buttons">
          <button class="pain-location-btn btn-secondary" data-location="shoulder">Shoulder</button>
          <button class="pain-location-btn btn-secondary" data-location="elbow">Elbow</button>
          <button class="pain-location-btn btn-secondary" data-location="wrist">Wrist</button>
          <button class="pain-location-btn btn-secondary" data-location="lower_back">Lower back</button>
          <button class="pain-location-btn btn-secondary" data-location="knee">Knee</button>
          <button class="pain-location-btn btn-secondary" data-location="hip">Hip</button>
          <button class="pain-location-btn btn-secondary" data-location="other">Other</button>
        </div>
      </div>

      <p id="pain-history" class="pain-history"></p>
    </div>
  </div>

  <!-- Post-Workout Pain Modal -->
  <div id="post-workout-pain-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <h2 class="modal-title">Workout Complete! üí™</h2>

      <!-- Initial pain check -->
      <div id="pain-initial-check">
        <p style="font-size: 18px; margin-bottom: 24px;">Did you experience any pain during this workout?</p>
        <button id="pain-no-btn" class="btn btn-primary" style="height: 60px; font-size: 18px; margin-bottom: 12px;">No Pain ‚úì</button>
        <button id="pain-yes-btn" class="btn btn-secondary" style="height: 60px; font-size: 18px;">Yes, I had pain ‚ö†Ô∏è</button>
      </div>

      <!-- Exercise selection (hidden initially) -->
      <div id="pain-exercise-selection" style="display: none;">
        <p style="font-size: 16px; margin-bottom: 16px;">Which exercises had pain? (Select all that apply)</p>
        <div id="pain-exercise-list" class="pain-exercise-checkboxes">
          <!-- Populated dynamically -->
        </div>
        <button id="pain-selection-next-btn" class="btn btn-primary" style="margin-top: 16px; height: 50px;">Next</button>
      </div>

      <!-- Pain details for selected exercise (hidden initially) -->
      <div id="pain-details" style="display: none;">
        <h3 id="pain-detail-exercise-name" style="margin-bottom: 16px;"></h3>
        <p id="pain-detail-progress" style="font-size: 14px; color: #888; margin-bottom: 16px;"></p>

        <p style="margin-bottom: 12px;">How severe was the pain?</p>
        <div style="display: flex; gap: 12px; margin-bottom: 24px;">
          <button class="pain-severity-btn btn btn-secondary" data-severity="minor" style="flex: 1; height: 50px;">Minor</button>
          <button class="pain-severity-btn btn btn-secondary" data-severity="significant" style="flex: 1; height: 50px;">Significant</button>
        </div>

        <p style="margin-bottom: 12px;">Where was the pain?</p>
        <div class="pain-location-buttons" style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
          <button class="pain-location-btn btn btn-secondary" data-location="shoulder">Shoulder</button>
          <button class="pain-location-btn btn btn-secondary" data-location="elbow">Elbow</button>
          <button class="pain-location-btn btn btn-secondary" data-location="wrist">Wrist</button>
          <button class="pain-location-btn btn btn-secondary" data-location="lower_back">Lower back</button>
          <button class="pain-location-btn btn btn-secondary" data-location="knee">Knee</button>
          <button class="pain-location-btn btn btn-secondary" data-location="hip">Hip</button>
          <button class="pain-location-btn btn btn-secondary" data-location="other">Other</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Exercise Unlock Notification Modal -->
  <div id="unlock-notification-modal" class="modal" style="display: none;">
    <div class="modal-content unlock-modal">
      <div class="unlock-header">
        <span class="unlock-icon">üéâ</span>
        <h2 id="unlock-title">New Exercise Unlocked!</h2>
      </div>
      <div class="unlock-body">
        <h3 id="unlock-exercise-name">Hindu Danda</h3>
        <p id="unlock-description">You've met the criteria to unlock this exercise!</p>

        <div class="unlock-criteria">
          <h4>Requirements Met:</h4>
          <ul id="unlock-criteria-list">
            <li class="met">‚úì Strength: 15kg √ó 3√ó12</li>
            <li class="met">‚úì Mobility: Thoracic mobility confirmed</li>
            <li class="met">‚úì Pain-free: 5+ workouts</li>
            <li class="met">‚úì Training: 8+ weeks</li>
          </ul>
        </div>

        <div class="unlock-actions">
          <button id="unlock-try-btn" class="btn-primary">Switch to This Exercise</button>
          <button id="unlock-later-btn" class="btn-secondary">Maybe Later</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Exercise Progressions Browse Modal -->
  <div id="progressions-modal" class="modal" style="display: none;">
    <div class="modal-content progressions-modal-content">
      <div class="modal-header">
        <h2>Exercise Progressions</h2>
        <button class="close-modal" id="close-progressions-modal">&times;</button>
      </div>

      <div class="progressions-body">
        <div class="progressions-tabs">
          <button class="prog-tab active" data-workout="UPPER_A">Upper A</button>
          <button class="prog-tab" data-workout="LOWER_A">Lower A</button>
          <button class="prog-tab" data-workout="UPPER_B">Upper B</button>
          <button class="prog-tab" data-workout="LOWER_B">Lower B</button>
        </div>

        <div id="progressions-list" class="progressions-list">
          <!-- Populated dynamically -->
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="js/app.js"></script>

  <!-- Service Worker Registration -->
  <script>
    if ('serviceWorker' in navigator) {
      let refreshing = false;

      // Reload page when new Service Worker takes control
      navigator.serviceWorker.addEventListener('controllerchange', () => {
        if (!refreshing) {
          refreshing = true;
          window.location.reload();
        }
      });

      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js')
          .then((registration) => {
            console.log('Service Worker registered:', registration.scope);

            // Check for updates on every page load (dev mode)
            registration.update();

            // Listen for new Service Worker waiting
            registration.addEventListener('updatefound', () => {
              const newWorker = registration.installing;
              if (!newWorker) return;

              newWorker.addEventListener('statechange', () => {
                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                  // New Service Worker available
                  if (confirm('New version available! Reload to update?')) {
                    newWorker.postMessage({ type: 'SKIP_WAITING' });
                    // Note: page will reload when controllerchange event fires above
                  }
                }
              });
            });
          })
          .catch((error) => {
            console.error('Service Worker registration failed:', error);
          });
      });
    }
  </script>
</body>
</html>
